# Google OAuth 2.0 μ„¤μ • κ°€μ΄λ“

μ΄ λ¬Έμ„λ” Google Cloud Consoleμ—μ„ OAuth 2.0 ν΄λΌμ΄μ–ΈνΈ IDμ™€ μ‹ν¬λ¦Ώμ„ λ°κΈ‰λ°›κ³ , ν•„μ”ν• μ„¤μ •μ„ μ™„λ£ν•λ” μ „μ²΄ κ³Όμ •μ„ λ‹¨κ³„λ³„λ΅ μ•λ‚΄ν•©λ‹λ‹¤.

## λ©μ°¨

1. [μ‚¬μ „ μ¤€λΉ„](#1-μ‚¬μ „-μ¤€λΉ„)
2. [Google Cloud Console ν”„λ΅μ νΈ μƒμ„±](#2-google-cloud-console-ν”„λ΅μ νΈ-μƒμ„±)
3. [OAuth λ™μ ν™”λ©΄ μ„¤μ •](#3-oauth-λ™μ-ν™”λ©΄-μ„¤μ •)
4. [OAuth ν΄λΌμ΄μ–ΈνΈ ID μƒμ„±](#4-oauth-ν΄λΌμ΄μ–ΈνΈ-id-μƒμ„±)
   - 4.1 μκ²© μ¦λ… λ©”λ‰΄λ΅ μ΄λ™
   - 4.2 OAuth ν΄λΌμ΄μ–ΈνΈ ID μƒμ„±
   - 4.3 μ• ν”λ¦¬μΌ€μ΄μ… μ ν• μ„ νƒ
   - 4.4 μΉμΈλ λ¦¬λ””λ ‰μ… URI μ¶”κ°€
   - 4.5 ν΄λΌμ΄μ–ΈνΈ IDμ™€ μ‹ν¬λ¦Ώ ν™•μΈ
   - 4.6 ν…μ¤νΈ μ‚¬μ©μ μ¶”κ°€ (μ™Έλ¶€ μ•±μΈ κ²½μ°)
   - 4.7 λ²”μ„(Scope) μ„¤μ •
5. [ν™κ²½ λ³€μ μ„¤μ •](#5-ν™κ²½-λ³€μ-μ„¤μ •)
6. [ν…μ¤νΈ λ° ν™•μΈ](#6-ν…μ¤νΈ-λ°-ν™•μΈ)
7. [λ¬Έμ  ν•΄κ²° (FAQ)](#7-λ¬Έμ -ν•΄κ²°-faq)
8. [μ¶”κ°€ μλ£](#8-μ¶”κ°€-μλ£)

---

## 1. μ‚¬μ „ μ¤€λΉ„

κµ¬κΈ€ OAuth μ„¤μ •μ„ μ‹μ‘ν•κΈ° μ „μ— λ‹¤μμ΄ ν•„μ”ν•©λ‹λ‹¤:

- β… Google κ³„μ • (Gmail κ³„μ •)
- β… μ›Ή λΈλΌμ°μ € (Chrome, Firefox, Safari λ“±)
- β… λ΅μ»¬ κ°λ° ν™κ²½ (Python, FastAPI μ„¤μΉ)

---

## 2. Google Cloud Console ν”„λ΅μ νΈ μƒμ„±

### 2.1 Google Cloud Console μ ‘μ†

1. μ›Ή λΈλΌμ°μ €μ—μ„ [Google Cloud Console](https://console.cloud.google.com/)μ— μ ‘μ†ν•©λ‹λ‹¤.
2. Google κ³„μ •μΌλ΅ λ΅κ·ΈμΈν•©λ‹λ‹¤.

![Google Cloud Console μ ‘μ†](./image/google-console-home.png)

### 2.2 μƒ ν”„λ΅μ νΈ μƒμ„±

1. ν™”λ©΄ μƒλ‹¨μ ν”„λ΅μ νΈ μ„ νƒ λ“λ΅­λ‹¤μ΄μ„ ν΄λ¦­ν•©λ‹λ‹¤.
2. **"μƒ ν”„λ΅μ νΈ"** λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤.

<img src="./image/google-console-select-project.png" alt="ν”„λ΅μ νΈ μ„ νƒ λ©”λ‰΄" width="600">

3. ν”„λ΅μ νΈ μ •λ³΄ μ…λ ¥:
   - **ν”„λ΅μ νΈ μ΄λ¦„**: μ›ν•λ” μ΄λ¦„ μ…λ ¥ (μ: `my-oauth-app`)
   - **μ„μΉ**: μ΅°μ§ μ„ νƒ (μ—†μΌλ©΄ "μ΅°μ§ μ—†μ" μ„ νƒ)
4. **"λ§λ“¤κΈ°"** λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤.

![ν”„λ΅μ νΈ μƒμ„± ν™”λ©΄](./image/google-console-create-project.png)

5. ν”„λ΅μ νΈ μƒμ„±μ΄ μ™„λ£λλ©΄ μλ™μΌλ΅ μ„ νƒλ©λ‹λ‹¤ (μ•½ 1-2λ¶„ μ†μ”).

6. ν”„λ΅μ νΈ μƒμ„±μ΄ μ™„λ£λλ©΄ μλ™μΌλ΅ μ„ νƒλ©λ‹λ‹¤.

---

## 3. OAuth ν”„λ΅μ νΈ κµ¬μ„± (μ•± μ •λ³΄ μ…λ ¥)

OAuthλ¥Ό μ‚¬μ©ν•λ ¤λ©΄ λ¨Όμ € ν”„λ΅μ νΈλ¥Ό κµ¬μ„±ν•κ³  μ•± μ •λ³΄λ¥Ό μ…λ ¥ν•΄μ•Ό ν•©λ‹λ‹¤.

### 3.1 ν΄λΌμ΄μ–ΈνΈ λ©”λ‰΄λ΅ μ΄λ™

1. μΆμΈ΅ λ©”λ‰΄μ—μ„ **"ν΄λΌμ΄μ–ΈνΈ"** νƒ­μ„ ν΄λ¦­ν•©λ‹λ‹¤.

> π’΅ **μ°Έκ³ **: λλ” μΆμΈ΅ λ©”λ‰΄μ—μ„ **"API λ° μ„λΉ„μ¤"** > **"μ‚¬μ©μ μΈμ¦ μ •λ³΄"**λ¥Ό ν΄λ¦­ν• ν›„ **"ν΄λΌμ΄μ–ΈνΈ"** νƒ­μΌλ΅ μ΄λ™ν•©λ‹λ‹¤.

2. μ•„μ§ μ•±μ΄ μƒμ„±λμ§€ μ•μ€ μƒνƒμ΄λ―€λ΅ **"μ‹μ‘ν•κΈ°"** λ²„νΌμ΄ ν‘μ‹λ©λ‹λ‹¤.

![ν΄λΌμ΄μ–ΈνΈ μ΄κΈ° ν™”λ©΄](./image/credentials-menu.png)

3. **"μ‹μ‘ν•κΈ°"** λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤.

### 3.2 ν”„λ΅μ νΈ κµ¬μ„± - μ•± μ •λ³΄ μ…λ ¥

**"ν”„λ΅μ νΈ κµ¬μ„±"** μ„Ήμ…μ΄ λ‚νƒ€λ‚λ©°, λ¨Όμ € **"μ•± μ •λ³΄"**λ¥Ό μ…λ ¥ν•©λ‹λ‹¤.

1. λ‹¤μ μ •λ³΄λ¥Ό μ…λ ¥ν•©λ‹λ‹¤:
   - **μ•± μ΄λ¦„**: μ‚¬μ©μμ—κ² ν‘μ‹λ  μ•± μ΄λ¦„ (μ: `λ‚΄ OAuth ν…μ¤νΈ μ•±`)
   - **μ‚¬μ©μ μ§€μ› μ΄λ©”μΌ**: μ‚¬μ©μκ°€ λ¬Έμν•  μ΄λ©”μΌ μ£Όμ†

![μ•± μ •λ³΄ μ…λ ¥](./image/consent-branding.png)

2. **"λ‹¤μ"** λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤.

### 3.3 ν”„λ΅μ νΈ κµ¬μ„± - λ€μƒ (μ‚¬μ©μ μ ν•)

**"ν”„λ΅μ νΈ κµ¬μ„±"** μ„Ήμ…μ **"λ€μƒ"** ν•­λ©μ„ μ„¤μ •ν•©λ‹λ‹¤.

1. **"μ™Έλ¶€"** λλ” **"λ‚΄λ¶€"** μ„ νƒ:
   - **μ™Έλ¶€**: μΌλ° μ‚¬μ©μ(Gmail κ³„μ •)κ°€ λ΅κ·ΈμΈ κ°€λ¥
   - **λ‚΄λ¶€**: Google Workspace μ΅°μ§ λ‚΄ μ‚¬μ©μλ§ λ΅κ·ΈμΈ κ°€λ¥
   
   > π’΅ **κ°μΈ ν”„λ΅μ νΈλ‚ ν…μ¤νΈμ©**: "μ™Έλ¶€" μ„ νƒ
   
   > π’΅ **νμ‚¬ λ‚΄λ¶€μ©**: "λ‚΄λ¶€" μ„ νƒ (Google Workspace κ³„μ • ν•„μ”)

![μ‚¬μ©μ μ ν• μ„ νƒ](./image/consent-audience.png)

2. **"λ‹¤μ"** λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤.

### 3.4 ν”„λ΅μ νΈ κµ¬μ„± - μ—°λ½μ² μ •λ³΄

**"ν”„λ΅μ νΈ κµ¬μ„±"** μ„Ήμ…μ **"μ—°λ½μ²"** ν•­λ©μ„ μ„¤μ •ν•©λ‹λ‹¤.

1. λ‹¤μ μ •λ³΄λ¥Ό μ…λ ¥ν•©λ‹λ‹¤:
   - **μ—°λ½μ² μ΄λ©”μΌ**: μ•± κ΄€λ ¨ λ¬Έμμ‚¬ν•­μ„ λ°›μ„ μ΄λ©”μΌ μ£Όμ†
   - **μ•± λ΅κ³ ** (μ„ νƒμ‚¬ν•­): 120x120px μ΄λ―Έμ§€
   - **μ•± ν™νμ΄μ§€** (μ„ νƒμ‚¬ν•­): μ•± μ›Ήμ‚¬μ΄νΈ URL
   - **κ°μΈμ •λ³΄μ²λ¦¬λ°©μΉ¨ λ§ν¬** (μ„ νƒμ‚¬ν•­): κ°μΈμ •λ³΄μ²λ¦¬λ°©μΉ¨ νμ΄μ§€ URL
   - **μ„λΉ„μ¤ μ•½κ΄€ λ§ν¬** (μ„ νƒμ‚¬ν•­): μ„λΉ„μ¤ μ•½κ΄€ νμ΄μ§€ URL

![μ—°λ½μ² μ •λ³΄ μ…λ ¥](./image/consent-contact-info.png)

2. **"λ‹¤μ"** λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤.

### 3.5 μ™„λ£ λ‹¨κ³„

**4λ‹¨κ³„: μ™„λ£**

1. **"Google API μ„λΉ„μ¤: μ‚¬μ©μ λ°μ΄ν„° μ •μ±…"** μ²΄ν¬λ°•μ¤λ¥Ό ν΄λ¦­ν•μ—¬ λ™μν•©λ‹λ‹¤.

![μ™„λ£ λ‹¨κ³„](./image/consent-complete.png)

2. **"κ³„μ†"** λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤.

3. λ‹¤μ ν™”λ©΄μ—μ„ **"λ§λ“¤κΈ°"** λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤.

ν”„λ΅μ νΈ κµ¬μ„±μ΄ μ™„λ£λμ—μµλ‹λ‹¤. μ΄μ  OAuth ν΄λΌμ΄μ–ΈνΈ IDλ¥Ό μƒμ„±ν•  μ μμµλ‹λ‹¤.

---

## 4. OAuth ν΄λΌμ΄μ–ΈνΈ ID μƒμ„±

μ΄μ  μ‹¤μ λ΅ μ‚¬μ©ν•  ν΄λΌμ΄μ–ΈνΈ IDμ™€ μ‹ν¬λ¦Ώμ„ μƒμ„±ν•©λ‹λ‹¤.

### 4.1 OAuth ν΄λΌμ΄μ–ΈνΈ ID μƒμ„±

ν”„λ΅μ νΈ κµ¬μ„±μ΄ μ™„λ£λ ν›„ **"ν΄λΌμ΄μ–ΈνΈ"** νƒ­ ν™”λ©΄μ—μ„ OAuth ν΄λΌμ΄μ–ΈνΈ IDλ¥Ό μƒμ„±ν•  μ μμµλ‹λ‹¤.

**"OAuth ν΄λΌμ΄μ–ΈνΈ λ§λ“¤κΈ°"** λ²„νΌμ„ ν΄λ¦­ν•λ©΄ **"OAuth ν΄λΌμ΄μ–ΈνΈ ID λ§λ“¤κΈ°"** ν™”λ©΄μ΄ λ‚νƒ€λ‚©λ‹λ‹¤.

### 4.3 μ• ν”λ¦¬μΌ€μ΄μ… μ ν• μ„ νƒ

1. **μ• ν”λ¦¬μΌ€μ΄μ… μ ν•** λ“λ΅­λ‹¤μ΄ λ©”λ‰΄μ—μ„ **"μ›Ή μ• ν”λ¦¬μΌ€μ΄μ…"** μ„ νƒ

![μ• ν”λ¦¬μΌ€μ΄μ… μ ν• μ„ νƒ](./image/create-oauth-client.png)

2. **μ΄λ¦„**: ν΄λΌμ΄μ–ΈνΈ μ΄λ¦„ μ…λ ¥ (μ: `oauth-client`)

ν΄λΌμ΄μ–ΈνΈ μ΄λ¦„μ„ μ…λ ¥ν•λ©΄ μ•„λμ— λ‘ κ°μ μ„Ήμ…μ΄ λ‚νƒ€λ‚©λ‹λ‹¤:
- **μΉμΈλ Javascript μ›λ³Έ**
- **μΉμΈλ λ¦¬λ””λ ‰μ… URI**

### 4.4 μΉμΈλ λ¦¬λ””λ ‰μ… URI μ¶”κ°€

**κ°€μ¥ μ¤‘μ”ν• λ‹¨κ³„μ…λ‹λ‹¤!**

1. **"μΉμΈλ λ¦¬λ””λ ‰μ… URI"** μ„Ήμ…μ—μ„ **"URI μ¶”κ°€"** λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤.
2. λ‹¤μ URIλ¥Ό μ¶”κ°€ν•©λ‹λ‹¤:

   ```
   http://localhost:8000/callback
   ```

   > π’΅ **μ°Έκ³ **: 
   - μμ  μ½”λ“(`src/google_oauth.py`)λ” κΈ°λ³Έμ μΌλ΅ `http://localhost:8000`μ—μ„ μ‹¤ν–‰λ©λ‹λ‹¤.
   - μ½λ°± κ²½λ΅λ” `/callback`μΌλ΅ μ„¤μ •λμ–΄ μμµλ‹λ‹¤.
   - ν”„λ΅λ•μ… ν™κ²½μ—μ„λ” `https://yourdomain.com/callback` ν•μ‹μΌλ΅ μ¶”κ°€ν•μ„Έμ”.

![Redirect URI μ¶”κ°€](./image/add-redirect-uri.png)

3. **"λ§λ“¤κΈ°"** λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤.

### 4.5 ν΄λΌμ΄μ–ΈνΈ IDμ™€ μ‹ν¬λ¦Ώ ν™•μΈ

μƒμ„±μ΄ μ™„λ£λλ©΄ λ‹¤μ μ •λ³΄κ°€ ν‘μ‹λ©λ‹λ‹¤:

- **ν΄λΌμ΄μ–ΈνΈ ID**: `123456789-abcdefghijklmnop.apps.googleusercontent.com` (μ΄ ν•μ‹)
- **ν΄λΌμ΄μ–ΈνΈ λ³΄μ• λΉ„λ°€λ²νΈ**: `GOCSPX-xxxxxxxxxxxxxx` (μ΄ ν•μ‹)

<img src="./image/client-id-secret.png" alt="ν΄λΌμ΄μ–ΈνΈ IDμ™€ μ‹ν¬λ¦Ώ" width="600">

β οΈ **μ¤‘μ”**: 
- **ν΄λΌμ΄μ–ΈνΈ λ³΄μ• λΉ„λ°€λ²νΈ**λ” μ΄ ν™”λ©΄μ—μ„λ§ ν™•μΈν•  μ μμµλ‹λ‹¤.
- λ°λ“μ‹ λ³µμ‚¬ν•μ—¬ μ•μ „ν• κ³³μ— μ €μ¥ν•μ„Έμ” (λ‹¤μ λ‹¨κ³„μ—μ„ .env νμΌμ— μ…λ ¥ν•©λ‹λ‹¤).

4. ν™•μΈ ν™”λ©΄μ„ λ‹«μΌλ©΄, λ°©κΈ μƒμ„±ν• ν΄λΌμ΄μ–ΈνΈκ°€ **ν΄λΌμ΄μ–ΈνΈ λ©λ΅**μ— λ‚νƒ€λ‚©λ‹λ‹¤.

![ν΄λΌμ΄μ–ΈνΈ λ©λ΅](./image/credentials-list.png)

> π’΅ **μ°Έκ³ **: μ΄ν›„ ν΄λΌμ΄μ–ΈνΈ IDμ™€ μ‹ν¬λ¦Ώμ„ λ‹¤μ‹ ν™•μΈν•κ±°λ‚ μμ •ν•λ ¤λ©΄ ν΄λΌμ΄μ–ΈνΈ λ©λ΅μ—μ„ ν•΄λ‹Ή ν΄λΌμ΄μ–ΈνΈλ¥Ό ν΄λ¦­ν•λ©΄ λ©λ‹λ‹¤. λ‹¤λ§ ν΄λΌμ΄μ–ΈνΈ λ³΄μ• λΉ„λ°€λ²νΈλ” μ²μ μƒμ„± μ‹μ—λ§ ν™•μΈν•  μ μμΌλ―€λ΅, λ°λ“μ‹ μ•μ „ν•κ² λ³΄κ΄€ν•μ„Έμ”.

---

### 4.6 ν…μ¤νΈ μ‚¬μ©μ μ¶”κ°€ (μ™Έλ¶€ μ•±μΈ κ²½μ°)

OAuth ν΄λΌμ΄μ–ΈνΈ ID μƒμ„±μ΄ μ™„λ£λμ—μµλ‹λ‹¤. μ΄μ  **μ™Έλ¶€ μ•±**μ κ²½μ° ν…μ¤νΈ μ‚¬μ©μλ¥Ό μ¶”κ°€ν•΄μ•Ό ν•©λ‹λ‹¤.

### 4.6.1 λ€μƒ λ©”λ‰΄λ΅ μ΄λ™

1. μΆμΈ΅ λ©”λ‰΄μ—μ„ **"λ€μƒ"** νƒ­μ„ ν΄λ¦­ν•©λ‹λ‹¤.

![λ€μƒ λ©”λ‰΄](./image/target-menu.png)

### 4.6.2 μ•± μƒνƒ ν™•μΈ

**"λ€μƒ"** ν™”λ©΄μ—μ„ λ‹¤μ μ •λ³΄λ¥Ό ν™•μΈν•  μ μμµλ‹λ‹¤:

- **κ²μ‹ μƒνƒ**: **"ν…μ¤νΈ μ¤‘"**μΌλ΅ ν‘μ‹λ¨
- **μ•± κ²μ‹** λ²„νΌ: μ•±μ„ ν”„λ΅λ•μ…μΌλ΅ κ²μ‹ν•  λ• μ‚¬μ©
- **μ‚¬μ©μ μ ν•**: **"μ™Έλ¶€"**λ΅ ν‘μ‹λ¨
- **OAuth μ‚¬μ©μ ν•λ„**: ν…μ¤νΈ μ¤‘μΌ λ• μ ν• μ‚¬ν•­ ν‘μ‹

### 4.6.3 ν…μ¤νΈ μ‚¬μ©μ μ¶”κ°€

**"ν…μ¤νΈ μ‚¬μ©μ"** μ„Ήμ…μ—μ„ ν…μ¤νΈν•  μ‚¬μ©μλ¥Ό μ¶”κ°€ν•©λ‹λ‹¤.

1. **"Add users"** λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤.
2. ν…μ¤νΈν•  Google κ³„μ • μ΄λ©”μΌ μ£Όμ†λ¥Ό μ…λ ¥ν•©λ‹λ‹¤.
3. **"μ €μ¥"** λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤.

![ν…μ¤νΈ μ‚¬μ©μ μ¶”κ°€](./image/add-test-users.png)

> β οΈ **μ¤‘μ”**: 
> - μ•±μ΄ **"ν…μ¤νΈ μ¤‘"** μƒνƒμΌ λ•λ” ν…μ¤νΈ μ‚¬μ©μλ΅ μ¶”κ°€λ κ³„μ •λ§ λ΅κ·ΈμΈν•  μ μμµλ‹λ‹¤.
> - μ—¬λ¬ μ‚¬μ©μλ¥Ό μ¶”κ°€ν•λ ¤λ©΄ κ°κ° μ¶”κ°€ν•κ±°λ‚, μ‰Όν‘λ΅ κµ¬λ¶„ν•μ—¬ μ—¬λ¬ μ΄λ©”μΌμ„ ν• λ²μ— μ…λ ¥ν•  μ μμµλ‹λ‹¤.

---

### 4.7 λ²”μ„(Scope) μ„¤μ •

OAuth ν΄λΌμ΄μ–ΈνΈ ID μƒμ„±μ΄ μ™„λ£λμ—μµλ‹λ‹¤. μ΄μ  μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μ”μ²­ν•  λ°μ΄ν„° λ²”μ„(Scope)λ¥Ό μ„¤μ •ν•©λ‹λ‹¤.

### 4.7.1 λ°μ΄ν„° μ–µμ„Έμ¤ λ©”λ‰΄λ΅ μ΄λ™

1. μΆμΈ΅ λ©”λ‰΄μ—μ„ **"λ°μ΄ν„° μ–µμ„Έμ¤"** νƒ­μ„ ν΄λ¦­ν•©λ‹λ‹¤.

![λ°μ΄ν„° μ–µμ„Έμ¤ λ©”λ‰΄](./image/data-access-menu.png)

### 4.7.2 λ²”μ„ μ¶”κ°€ λλ” μ‚­μ 

**"λ°μ΄ν„° μ–µμ„Έμ¤"** ν™”λ©΄μ—μ„ **"λ²”μ„ μ¶”κ°€ λλ” μ‚­μ "** λ²„νΌμ΄ λ³΄μ…λ‹λ‹¤.

1. **"λ²”μ„ μ¶”κ°€ λλ” μ‚­μ "** λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤.
2. ν•„μ”ν• λ²”μ„λ¥Ό μ„ νƒν•©λ‹λ‹¤:

   κΈ°λ³Έ λ²”μ„ (ν”„λ΅ν•„ μ •λ³΄):
   - β… `openid` - OpenID Connect μΈμ¦
   - β… `email` - μ‚¬μ©μ μ΄λ©”μΌ μ£Όμ†
   - β… `profile` - κΈ°λ³Έ ν”„λ΅ν•„ μ •λ³΄ (μ΄λ¦„, ν”„λ΅ν•„ μ‚¬μ§„ λ“±)

![λ²”μ„ μ„ νƒ ν™”λ©΄](./image/consent-scopes.png)

3. **"μ—…λ°μ΄νΈ"** λ²„νΌμ„ ν΄λ¦­ν•©λ‹λ‹¤.
4. **"Save"** λ²„νΌμ„ ν΄λ¦­ν•μ—¬ λ³€κ²½ μ‚¬ν•­μ„ μ €μ¥ν•©λ‹λ‹¤.

> β οΈ **μ£Όμ**: 
> - λ―Όκ°ν• λ²”μ„(μ: Google Drive, Gmail μ½κΈ°)λ” Google κ²€μκ°€ ν•„μ”ν•©λ‹λ‹¤.
> - ν•™μµμ©μΌλ΅λ” κΈ°λ³Έ λ²”μ„(`openid`, `profile`, `email`)λ§ μ‚¬μ©ν•μ„Έμ”.

---

## 5. ν™κ²½ λ³€μ μ„¤μ •

μ΄μ  λ°κΈ‰λ°›μ€ ν΄λΌμ΄μ–ΈνΈ IDμ™€ μ‹ν¬λ¦Ώμ„ ν™κ²½ λ³€μλ΅ μ„¤μ •ν•©λ‹λ‹¤.

### 7.1 .env νμΌ μƒμ„±

ν”„λ΅μ νΈ λ£¨νΈ λ””λ ‰ν† λ¦¬μ— `.env` νμΌμ„ μƒμ„±ν•©λ‹λ‹¤:

```bash
# ν”„λ΅μ νΈ λ£¨νΈμ—μ„
touch .env
```

### 7.2 .env νμΌμ— κ°’ μ…λ ¥

`.env` νμΌμ„ μ—΄κ³  λ‹¤μ λ‚΄μ©μ„ μ…λ ¥ν•©λ‹λ‹¤:

```env
# Google OAuth μ„¤μ •
GOOGLE_CLIENT_ID=123456789-abcdefghijklmnop.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=GOCSPX-xxxxxxxxxxxxxx
GOOGLE_REDIRECT_URI=http://localhost:8000/callback
```

> β οΈ **μ£Όμ**: 
> - `GOOGLE_CLIENT_ID`μ™€ `GOOGLE_CLIENT_SECRET`λ” 4.5λ‹¨κ³„μ—μ„ λ³µμ‚¬ν• μ‹¤μ  κ°’μΌλ΅ κµμ²΄ν•μ„Έμ”.
> - `.env` νμΌμ€ μ λ€ Gitμ— μ»¤λ°‹ν•μ§€ λ§μ„Έμ”! (`.gitignore`μ— μ¶”κ°€λμ–΄ μλ”μ§€ ν™•μΈ)

![.env νμΌ μμ‹](./image/fastapi-env.png)

### 7.3 .gitignore ν™•μΈ

`.gitignore` νμΌμ— `.env`κ°€ ν¬ν•¨λμ–΄ μλ”μ§€ ν™•μΈν•μ„Έμ”:

```gitignore
.env
*.env
.env.local
```

---

## 6. ν…μ¤νΈ λ° ν™•μΈ

μ΄μ  λ¨λ“  μ„¤μ •μ΄ μ™„λ£λμ—μµλ‹λ‹¤. μμ  μ½”λ“λ¥Ό μ‹¤ν–‰ν•΄λ΄…μ‹λ‹¤.

### 8.1 μ„λ²„ μ‹¤ν–‰

ν„°λ―Έλ„μ—μ„ λ‹¤μ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤:

```bash
python src/google_oauth.py
```

μ„±κ³µν•λ©΄ λ‹¤μκ³Ό κ°™μ€ λ©”μ‹μ§€κ°€ ν‘μ‹λ©λ‹λ‹¤:

```
INFO:     Started server process
INFO:     Uvicorn running on http://0.0.0.0:8000
```

### 8.2 λ΅κ·ΈμΈ ν…μ¤νΈ

1. μ›Ή λΈλΌμ°μ €μ—μ„ `http://localhost:8000/login` μ ‘μ†
2. Google λ΅κ·ΈμΈ νμ΄μ§€λ΅ λ¦¬λ””λ ‰μ…λ©λ‹λ‹¤
3. Google κ³„μ • μ„ νƒ λ° κ¶ν• μΉμΈ
4. `/callback`μΌλ΅ λ¦¬λ””λ ‰μ…λλ©° μ‚¬μ©μ μ •λ³΄κ°€ JSON ν•μ‹μΌλ΅ ν‘μ‹λ©λ‹λ‹¤

### 8.3 μμƒ μ‘λ‹µ

μ„±κ³µ μ‹ λ‹¤μκ³Ό κ°™μ€ JSON μ‘λ‹µμ„ λ°›μµλ‹λ‹¤:

```json
{
  "id": "123456789012345678901",
  "email": "user@example.com",
  "verified_email": true,
  "name": "ν™κΈΈλ™",
  "given_name": "κΈΈλ™",
  "family_name": "ν™",
  "picture": "https://lh3.googleusercontent.com/...",
  "locale": "ko"
}
```

### 8.4 OAuth μΈμ¦ νλ¦„λ„

```
1. μ‚¬μ©μ β†’ http://localhost:8000/login μ ‘μ†
2. μ„λ²„ β†’ Google λ΅κ·ΈμΈ νμ΄μ§€λ΅ λ¦¬λ””λ ‰μ…
3. μ‚¬μ©μ β†’ Google κ³„μ • μ„ νƒ λ° κ¶ν• μΉμΈ
4. Google β†’ http://localhost:8000/callback?code=xxx λ΅ λ¦¬λ””λ ‰μ…
5. μ„λ²„ β†’ codeλ¥Ό μ•΅μ„Έμ¤ ν† ν°μΌλ΅ κµν™
6. μ„λ²„ β†’ μ•΅μ„Έμ¤ ν† ν°μΌλ΅ μ‚¬μ©μ μ •λ³΄ μ΅°ν
7. μ„λ²„ β†’ μ‚¬μ©μ μ •λ³΄λ¥Ό JSONμΌλ΅ λ°ν™
```

![OAuth νλ¦„ λ‹¤μ΄μ–΄κ·Έλ¨](./image/oauth-flow-diagram.png)

---

## 7. λ¬Έμ  ν•΄κ²° (FAQ)

### Q1: `redirect_uri_mismatch` μ¤λ¥ λ°μƒ

**μ¦μƒ:**
```
Error 400: redirect_uri_mismatch
```

**ν•΄κ²° λ°©λ²•:**
1. Google Cloud Consoleμ—μ„ λ“±λ΅ν• Redirect URIμ™€ μ½”λ“μ URIκ°€ **μ •ν™•ν μΌμΉ**ν•λ”μ§€ ν™•μΈ:
   - `http://localhost:8000/callback` β† μ •ν™•ν λ™μΌν•΄μ•Ό ν•¨
   - `http://localhost:8000/callback/` β† λμ— μ¬λμ‹ μμΌλ©΄ μ¤λ¥
   - `https://localhost:8000/callback` β† http vs https μ°¨μ΄
2. ν΄λΌμ΄μ–ΈνΈ ID μ„¤μ •μ—μ„ Redirect URI μμ •/μ¶”κ°€
3. λΈλΌμ°μ € μΊμ‹ μ‚­μ  ν›„ μ¬μ‹λ„

### Q2: `invalid_client` μ¤λ¥ λ°μƒ

**μ¦μƒ:**
```
Error 401: invalid_client
```

**ν•΄κ²° λ°©λ²•:**
1. `.env` νμΌμ `GOOGLE_CLIENT_ID`μ™€ `GOOGLE_CLIENT_SECRET`κ°€ μ¬λ°”λ¥Έμ§€ ν™•μΈ
2. ν΄λΌμ΄μ–ΈνΈ μ‹ν¬λ¦Ώμ— κ³µλ°±μ΄λ‚ μ¤„λ°”κΏμ΄ μ—†λ”μ§€ ν™•μΈ
3. ν™κ²½ λ³€μκ°€ μ λ€λ΅ λ΅λ“λμ—λ”μ§€ ν™•μΈ:
   ```python
   print(os.getenv('GOOGLE_CLIENT_ID'))  # Noneμ΄ μ•„λ‹μ–΄μ•Ό ν•¨
   ```

### Q3: `access_denied` μ¤λ¥ λ°μƒ

**μ¦μƒ:**
```
Error 403: access_denied
```

**ν•΄κ²° λ°©λ²•:**
1. **μ™Έλ¶€ μ•± + ν…μ¤νΈ μ¤‘ μƒνƒ**μΈ κ²½μ°:
   - OAuth λ™μ ν™”λ©΄μ—μ„ ν…μ¤νΈ μ‚¬μ©μλ΅ μ΄λ©”μΌ μ¶”κ°€ ν•„μ”
   - ν…μ¤νΈν•  Google κ³„μ •μ΄ ν…μ¤νΈ μ‚¬μ©μ λ©λ΅μ— μλ”μ§€ ν™•μΈ
2. μ‚¬μ©μκ°€ κ¶ν• μΉμΈμ„ κ±°λ¶€ν• κ²½μ° β†’ λ‹¤μ‹ μ‹λ„

### Q4: ν† ν°μ΄ 7μΌ ν›„ λ§λ£λ¨

**μ¦μƒ:**
```
Refresh token expires after 7 days
```

**ν•΄κ²° λ°©λ²•:**
1. μ•±μ΄ **"ν…μ¤νΈ μ¤‘"** μƒνƒμ΄λ©΄ ν† ν°μ΄ 7μΌ ν›„ λ§λ£λ©λ‹λ‹¤
2. μ¥κΈ° ν† ν°μ„ μ‚¬μ©ν•λ ¤λ©΄:
   - OAuth λ™μ ν™”λ©΄μ—μ„ μ•±μ„ **"ν”„λ΅λ•μ…"**μΌλ΅ κ²μ‹
   - Google κ²€μ κ³Όμ • ν•„μ” (λ―Όκ°ν• scope μ‚¬μ© μ‹)

### Q5: scope κ΄€λ ¨ μ¤λ¥

**μ¦μƒ:**
```
Error: invalid_scope
```

**ν•΄κ²° λ°©λ²•:**
1. μ”μ²­ν• scopeκ°€ OAuth λ™μ ν™”λ©΄μ— μ¶”κ°€λμ—λ”μ§€ ν™•μΈ
2. λ―Όκ°ν• scope μ‚¬μ© μ‹ Google κ²€μ μ™„λ£ μ—¬λ¶€ ν™•μΈ
3. κΈ°λ³Έ scope (`openid profile email`)λ§ μ‚¬μ©ν•λ” κ²ƒμ΄ μ•μ „

### Q6: μ„λ²„κ°€ μ‹μ‘λμ§€ μ•μ

**μ¦μƒ:**
```
ModuleNotFoundError: No module named 'fastapi'
```

**ν•΄κ²° λ°©λ²•:**
1. ν•„μ”ν• ν¨ν‚¤μ§€ μ„¤μΉ:
   ```bash
   pip install fastapi uvicorn python-dotenv requests
   ```
2. λλ” `requirements.txt`μ—μ„ μ„¤μΉ:
   ```bash
   pip install -r requirements.txt
   ```

### Q7: `.env` νμΌμ΄ μΈμ‹λμ§€ μ•μ

**μ¦μƒ:**
ν™κ²½ λ³€μκ°€ `None`μΌλ΅ ν‘μ‹λ¨

**ν•΄κ²° λ°©λ²•:**
1. `.env` νμΌμ΄ ν”„λ΅μ νΈ λ£¨νΈ λ””λ ‰ν† λ¦¬μ— μλ”μ§€ ν™•μΈ
2. `python-dotenv` ν¨ν‚¤μ§€κ°€ μ„¤μΉλμ—λ”μ§€ ν™•μΈ:
   ```bash
   pip install python-dotenv
   ```
3. νμΌ κ²½λ΅ ν™•μΈ:
   ```python
   from pathlib import Path
   print(Path('.env').exists())  # Trueμ—¬μ•Ό ν•¨
   ```

---

## 8. μ¶”κ°€ μλ£

### κ³µμ‹ λ¬Έμ„

- [Google Identity - OAuth 2.0](https://developers.google.com/identity/protocols/oauth2)
- [OpenID Connect](https://developers.google.com/identity/openid-connect/openid-connect)
- [OAuth λ™μ ν™”λ©΄ μ„¤μ •](https://developers.google.com/identity/protocols/oauth2/openid-connect#consentflow)
- [FastAPI κ³µμ‹ λ¬Έμ„](https://fastapi.tiangolo.com/)

### κ΄€λ ¨ νμΌ

- μμ  μ½”λ“: `src/google_oauth.py`
- API κ°€μ΄λ“: `doc/api_guide.md`

---

**λ¬Έμ κ°€ ν•΄κ²°λμ§€ μ•μ•λ‚μ”?** 

- Google Cloud Consoleμ [λ¬Έμ  ν•΄κ²° κ°€μ΄λ“](https://developers.google.com/identity/protocols/oauth2/policies)λ¥Ό μ°Έκ³ ν•μ„Έμ”.
- FastAPI κ³µμ‹ λ¬Έμ„μ [OAuth μμ ](https://fastapi.tiangolo.com/advanced/security/oauth2-scopes/)λ¥Ό ν™•μΈν•μ„Έμ”.

---

**λ§μ§€λ§‰ μ—…λ°μ΄νΈ**: 2024λ…„
